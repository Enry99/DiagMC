<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>DiagMC: Diagrammatic Monte Carlo simulation of a 2-level spin system in an external magnetic field</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">DiagMC
   </div>
   <div id="projectbrief">Diagrammatic Monte Carlo simulation of a 2-level spin system in a magnetic field</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Diagrammatic Monte Carlo simulation of a 2-level spin system in an external magnetic field </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p ><a class="anchor" id="md_README"></a> <img src="https://github.com/Enry99/DiagMC/actions/workflows/cmake-multi-platform.yml/badge.svg" alt="example workflow" style="pointer-events: none;" class="inline"/> <a href="https://www.gnu.org/licenses/gpl-3.0"><img src="https://img.shields.io/badge/License-GPLv3-blue.svg" alt="License: GPL v3" style="pointer-events: none;" class="inline"/></a></p>
<p >This program implements a Markov Chain Monte Carlo algorithm, based on <a href="https://en.wikipedia.org/wiki/Metropolis%E2%80%93Hastings_algorithm">Metropolis-Hastings</a>, to sample Feynman diagrams associated to a series expansion of the partition function for a 2-level spin system in an external magnetic field, with longitudinal and transversal components. This method allows to calculate the magnetization along z and x, that can be compared to the theoretical values obtained by the exact diagonalization of the Hamiltonian. Its purpose is to use a simple and analytically-solvable system to become familiar with the implementation of a Diagrammatic Monte Carlo algorithm, which can be applied effectively in cases where no analytical solution exists, such as the study of complex electron-phonon interactions.</p>
<h1><a class="anchor" id="autotoc_md1"></a>
Installation using CMake</h1>
<p >The installation procedure relies on <a href="https://cmake.org/">CMake</a>, which is cross-platform and can be used on many operative systems, like Linux and Windows.\ Note that on Windows you need to have an available C++ compiler, such as <a href="https://docs.microsoft.com/en-us/cpp/">MSVC</a>, which is provided with <a href="https://visualstudio.microsoft.com/">Visual Studio</a>.\ A viable alternative on Windows is to use <a href="https://learn.microsoft.com/en-us/windows/wsl/">Windows Subsystem for Linux</a>.</p>
<p >First, <b>clone the repository</b> in your local machine using <a href="https://git-scm.com/">git</a>: </p><div class="fragment"><div class="line">$ git clone https://github.com/Enry99/DiagMC.git</div>
</div><!-- fragment --><p> This will create a folder called <code>DiagMC</code>. Go inside this folder with: </p><div class="fragment"><div class="line">$ cd DiagMC</div>
</div><!-- fragment --><p> Now <b>build and install</b> the program using <b>CMake</b>: </p><div class="fragment"><div class="line">$ mkdir build</div>
<div class="line">$ cd build</div>
<div class="line">$ cmake .. -DCMAKE_BUILD_TYPE=Release</div>
<div class="line">$ cmake --build . --target install --config Release</div>
</div><!-- fragment --><p> <b>The program executable can be found in <code>DiagMC/bin</code></b>.</p>
<h2><a class="anchor" id="autotoc_md2"></a>
Dependencies</h2>
<p >The program depends on the <a href="https://github.com/nlohmann/json.git">json</a> library for reading the settings from file, and on <a href="https://github.com/google/googletest.git">googletest</a> for unit testing. Both dependencies are automatically downloaded and included by CMake during the build process, so an Internet connection is required during the installation.</p>
<p >It is possible to exclude the googletest dependency by building without tests: </p><div class="fragment"><div class="line">$ cmake .. -DBUILD_TESTING=OFF</div>
</div><!-- fragment --><p> However, testing is recommended before using the program.</p>
<h2><a class="anchor" id="autotoc_md3"></a>
Execute unit tests</h2>
<p >In order to execute the tests, go to the <code>build</code> directory and run: </p><div class="fragment"><div class="line">$ ctest</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md4"></a>
Utilization guide</h1>
<p >The program reads the parameters from a json settings file. The path of the file can be passed as command line argument upon execution. If nothing is specified, the programs looks for 'settings.json'.</p>
<p >To run the program, go to the <code>bin</code> directory and execute it with: </p><div class="fragment"><div class="line">$ ./2levelDiagMC [settings_filename]</div>
</div><!-- fragment --><p> where you can replace <code>settings_filename</code> with the proper name of the desired json settings file.</p>
<p >The parameters for the settings file are described below.</p>
<p >Three types of calculations are possible, and need to be specified in the flag <code>CALC_TYPE</code>:</p><ol type="1">
<li>**"single"**, which performs a single run of the algorithm for the given parameters, writes the results to a csv file and prints a summary of the results on terminal. An example of settings file for this type of calculation is <a href="https://github.com/Enry99/DiagMC/blob/main/examples/settings_singlerun.json">settings_singlerun.json</a></li>
<li>**"sweep"**, which runs the algorithm for different values of <code>H</code>, <code>GAMMA</code> and <code>beta</code> in the given range, for all the combinations, and writes the results to a csv file. An example of settings file for this type of calculation is <a href="https://github.com/Enry99/DiagMC/blob/main/examples/settings_sweep.json">settings_sweep.json</a></li>
<li>**"convergence-test"**, which runs the program multiple times for a fixed set of physical parameters and the same seed, varying the number of steps of the simulation, <code>N_total_steps</code>, and optionally also <code>N_thermalization_steps</code>. An example of settings file for this type of calculation is <a href="https://github.com/Enry99/DiagMC/blob/main/examples/settings_conv_test.json">settings_conv_test.json</a></li>
</ol>
<p >The results for the three calculation types are written to a csv file, which must be specified as <code>output_file</code>, and contains columns corresponding to variables and lines corresponding to each run. The reported values include all the input parameters, the results for the two magnetizations, the statistics of acceptance for the updates, the maximum and average diagram order, the two seeds for each run, and the runtime of the Metropolis-Hastings loop (in nanoseconds) in the column "run_time".</p>
<p >The settings parameters for a single run are:</p><ul>
<li><code>beta</code>: Inverse temperature (equal to legnth of the diagram). Must be &gt; 0.</li>
<li><code>initial_s0</code> (optional): Spin of the 0-th segment of the diagram (0--&mdash;t1) at the beginning of the simulation. Must be +1 or -1. Defaults to +1 if not specified.</li>
<li><code>H</code>: Value of the longitudinal component of magnetic field.</li>
<li><code>GAMMA</code>: Value of the transversal component of magnetic field. Must be $\neq$ 0. Values much higher than one could cause severe slowdown due to creation of a huge number of vertices.</li>
<li><code>N_total_steps</code>: Total number of steps of the MCMC algorithm. For this system, values above 10 million give very accurate results.</li>
<li><code>N_thermalization_steps</code> (optional): Number of initial steps for which statistics is not collected. For the suggested value of <code>N_total_steps</code> can be safely set to 0. Defaults to 0 if not specified.</li>
<li><code>update_choice_seed</code> (optional): Seed for the Mersenne-Twister random number generator to choose <em>which</em> update to attempt. Must be a non-negative integer.</li>
<li><code>diagram_seed</code> (optional): Seed for the diagram, used <em>inside</em> the updates. Must be a non-negative integer.</li>
</ul>
<p >In "sweep" mode, one or more parameters between <code>H</code>, <code>GAMMA</code> and <code>beta</code> can be substituted by a parameter range and a step, with the variable name and the suffix <code>_min</code>, <code>_max</code> and <code>_step</code>, e.g.</p><ul>
<li><code>H_min</code>= -1,</li>
<li><code>H_max</code>= 1,</li>
<li><code>H_step</code>= 0.2</li>
</ul>
<p >In this mode it is not possible to set the seeds, which are assigned automatically in a unique way based on system clock.</p>
<p >In "convergence-test" mode, one or more parameters between <code>N_total_steps</code> and <code>N_thermalization_steps</code> can be substituted by a parameter range and the number of points per decade (the step is linear in logscale), with the variable name and the suffix <code>_min</code>, <code>_max</code> and <code>_points_per_decade</code>, e.g.</p>
<ul>
<li><code>N_total_steps_min</code> = 1e3,</li>
<li><code>N_total_steps_max</code> = 1e8,</li>
<li><code>N_total_steps_points_per_decade</code> = 4</li>
</ul>
<h1><a class="anchor" id="autotoc_md5"></a>
Examples</h1>
<p >The results of the sweep and convergence tests, produced with the two corresponding files in the <a href="https://github.com/Enry99/DiagMC/blob/main/examples">examples</a> folder, are reported in these images, showing a perfect match with the analytical results.</p>
<p ><img src="/examples/sweep_beta=10.0.png" alt="" width="800" class="inline"/> <img src="/examples/convergence_test.png" alt="" width="800" class="inline"/></p>
<p >These plots were generated using two Python scripts, provided in the <a href="https://github.com/Enry99/DiagMC/tree/main/examples">examples</a> folder. They can be run by passing as a command line argument the name of the csv with the results, e.g.</p>
<div class="fragment"><div class="line">$ python3 plot_h_gamma_sweep.py results_sweep.csv</div>
</div><!-- fragment --><p >Note that this scripts are provided just as examples and do not cover every plot possiblity from the results file.</p>
<h1><a class="anchor" id="autotoc_md6"></a>
Structure of the project</h1>
<p >The project is structured as follows:</p><ol type="1">
<li>the <a href="https://github.com/Enry99/DiagMC/blob/main/include/diagmc">include/diagmc</a> and <a href="https://github.com/Enry99/DiagMC/blob/main/src">src</a> folders, which contain the declarations and definitions of the classes and functions.\ The code is composed by the following units:<ul>
<li><a href="https://github.com/Enry99/DiagMC/blob/main/include/diagmc/diagram.h">diagram.h</a> / <a href="https://github.com/Enry99/DiagMC/blob/main/src/diagram.cpp">diagram.cpp</a> implement the <a class="el" href="classDiagram__core.html" title="This class is the base class of Diagram, and should not be used directly, aside from testing function...">Diagram_core</a> and <a class="el" href="classDiagram.html" title="This is the main Diagram class, containing the variables defining the diagram - inherited from Diagra...">Diagram</a> classes, which contain the variables defining a Feynman diagram, and the methods to attempt and perform the Monte Carlo updates, modifying the variables inside the object.\ In particular, <a class="el" href="classDiagram__core.html" title="This class is the base class of Diagram, and should not be used directly, aside from testing function...">Diagram_core</a> contains all the main functionalities of the diagram object, involving the <b>fully deterministic</b> part of the code, while <a class="el" href="classDiagram.html" title="This is the main Diagram class, containing the variables defining the diagram - inherited from Diagra...">Diagram</a> is a derived class of <a class="el" href="classDiagram__core.html" title="This class is the base class of Diagram, and should not be used directly, aside from testing function...">Diagram_core</a>, adding the random behaviour by including the (<a href="https://en.wikipedia.org/wiki/Mersenne_Twister">Mersenne-Twister</a>) random number generator, which allows to randomly perform updates within the object, without needing to pass values to the methods.\ A <a class="el" href="classDiagram.html" title="This is the main Diagram class, containing the variables defining the diagram - inherited from Diagra...">Diagram</a> object, once initalized, is fully self-sufficient to perform the desired sequence of updates.</li>
<li><a href="https://github.com/Enry99/DiagMC/blob/main/include/diagmc/simulation.h">simulation.h</a> / <a href="https://github.com/Enry99/DiagMC/blob/main/src/simulation.cpp">simulation.cpp</a> implement the core function of the algorithm, run_simulation, which executes the Metropolis Hastings algorithm loop, attempting updates at each iteration, and collecting statistics.\ Moreover, in these files the class <a class="el" href="classSingleRunResults.html" title="Container class to store all the simulation parameters, and the results of a run. It provides methods...">SingleRunResults</a> is implemented, which collects all the data pertaining to a run of the DMC loop (i.e. the input parameters, the results and the statisics).\ The <a class="el" href="classSingleRunResults.html" title="Container class to store all the simulation parameters, and the results of a run. It provides methods...">SingleRunResults</a> class has a method for printing a summary of the results to standard output, and a method to write the data to file in csv format. An object of this class is returned by the run_simulation function.</li>
<li><a href="https://github.com/Enry99/DiagMC/blob/main/include/diagmc/setup.h">setup.h</a> / <a href="https://github.com/Enry99/DiagMC/blob/main/src/setup.cpp">setup.cpp</a> implement the functions to read the settings from file, setup the proper parameters and run the selected type of calculations. In particular, the functions contain the loops to sweep over a range of the parameters and save the results of all the combination of parameters as rows of a csv file.</li>
<li><a href="https://github.com/Enry99/DiagMC/blob/main/src/main.cpp">main.cpp</a> is the main function of the executable, which calls the function setup function, with the possiblity to pass the name of the settings file as a command line argument.</li>
</ul>
</li>
<li>the <a href="https://github.com/Enry99/DiagMC/blob/main/tests">tests</a> folder, which contains the <a href="https://github.com/Enry99/DiagMC/blob/main/test/tests.cpp">tests.cpp</a> source file, with all the unit tests for the program. The test involve all methods of the <a class="el" href="classDiagram__core.html" title="This class is the base class of Diagram, and should not be used directly, aside from testing function...">Diagram_core</a> class, and the Metropolis-Hastings loop function, checking that the results coincide with the expected values</li>
<li>the <a href="https://github.com/Enry99/DiagMC/blob/main/examples">examples</a> folder, which contains three examples of settings files and the associated csv files with the results of the calculations, two python scripts to plot the results, and the plotted images. More on this in the Examples section.</li>
</ol>
<p >The documentation of all classes and functions (generated with <a href="https://www.doxygen.nl/">Doxygen</a>) can be found <a href="https://enry99.github.io/DiagMC/">here</a> under the 'Classes' and 'Files' menus.</p>
<h1><a class="anchor" id="autotoc_md7"></a>
Theory</h1>
<p >Diagrammatic Monte Carlo (DMC) is a very powerful method that allows to calculate quantities that can be expressed in terms of diagrammatic expansions of the form $$Q({y}) = \sum_{n=0}^\infty \sum_{\xi_n}\int dx_1 ... dx_n D_n^{\xi_n}(y </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5
</small></address>
</body>
</html>
